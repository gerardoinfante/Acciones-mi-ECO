<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Postal - Comp√°rtenos, ¬øen qu√© programas participaste este a√±o?</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      gap: 20px;
    }

    h1 {
      margin: 0;
      text-align: center;
    }

    .card {
      background: #020617;
      border-radius: 16px;
      padding: 16px 20px 20px;
      max-width: 520px;
      width: 100%;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      border: 1px solid #1f2937;
    }

    label {
      font-size: 14px;
    }

    .field {
      margin-bottom: 14px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    input[type="text"],
    select {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      font-size: 14px;
    }

    button {
      margin-top: 10px;
      width: 100%;
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      background: linear-gradient(135deg, #22c55e, #22d3ee);
      color: #020617;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
      box-shadow: 0 10px 25px rgba(34, 197, 94, 0.3);
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 32px rgba(34, 197, 94, 0.35);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 8px 20px rgba(34, 197, 94, 0.2);
    }

    .initiatives-container {
      border-radius: 12px;
      border: 1px dashed #4b5563;
      padding: 10px;
      max-height: 260px;
      overflow-y: auto;
    }

    .initiatives-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 10px;
    }

    .initiative-input {
      display: none;
    }

    .initiative-card {
      position: relative;
      border-radius: 12px;
      border: 1px solid #374151;
      padding: 6px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      background: radial-gradient(circle at top, #1f2937, #020617);
      transition: transform 0.1s ease, box-shadow 0.1s ease, border-color 0.1s ease;
    }

    .initiative-card img {
      width: 64px;
      height: 64px;
      object-fit: contain;
      display: block;
    }

    .initiative-card span {
      font-size: 11px;
      color: #9ca3af;
      text-align: center;
      line-height: 1.2;
    }

    .initiative-input:checked + .initiative-card {
      border-color: #22c55e;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.4);
      transform: translateY(-2px);
    }

    .preview {
      max-width: 360px;
      width: 100%;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
      border: 1px solid #1f2937;
      background: #020617;
    }

    .download-link {
      text-decoration: none;
      font-size: 14px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      color: #e5e7eb;
    }
  </style>
</head>

<body>
  <h1>üì∏ Programas en los que particip√© este a√±o</h1>
  <p style="max-width:520px;text-align:center;color:#9ca3af;">
    Escribe tu nombre, selecciona las iniciativas en las que participaste y genera tu postal lista para compartir en redes.
  </p>

  <div class="card">
    <div class="field">
      <label for="name">Nombre en la postal:</label>
      <input type="text" id="name" placeholder="Ej. Gerardo Infante" />
    </div>

    <div class="field">
      <label>Tema:</label>
      <select disabled>
        <option>Desarrollo y Crecimiento</option>
      </select>
    </div>

    <div class="field">
      <label>Selecciona iniciativas:</label>
      <div class="initiatives-container">
        <div id="initiativesGrid" class="initiatives-grid"></div>
      </div>
    </div>

    <button id="generateBtn">Generar postal</button>
  </div>

  <div id="output" style="display:none;">
    <h2 style="font-size:16px;margin:10px 0;">Vista previa</h2>
    <img id="previewImage" class="preview" />
    <br>
    <a id="downloadLink" class="download-link" download="mi_postal.png">‚¨áÔ∏è Descargar postal</a>
  </div>

  <canvas id="cardCanvas" width="1080" height="1080" style="display:none;"></canvas>

<script>
/* ---------------------------
   DEFINICI√ìN DEL TEMA 1
----------------------------- */
const THEMES = {
  desarrollo: {
    displayName: "Desarrollo y Crecimiento",
    initiatives: [
      { id: "english_tec", label: "English@Tec", img: "img/english@tec-logo-blanco.png" },
      { id: "mi_perfil", label: "Mi Perfil", img: "img/miPerfil-logo-blanco.png" },
      { id: "odc", label: "ODC", img: "img/ODC-logo-blanco.png" },
      { id: "oferta_desarrollo", label: "Oferta de Desarrollo", img: "img/OfertaDesarrollo-logo-blanco.png" }
    ]
  }
};

const initiativesGrid = document.getElementById("initiativesGrid");
const canvas = document.getElementById("cardCanvas");
const ctx = canvas.getContext("2d");
const previewImage = document.getElementById("previewImage");
const downloadLink = document.getElementById("downloadLink");
const output = document.getElementById("output");

/* ---------------------------
   BACKGROUND GLOBAL
----------------------------- */
let backgroundImg = new Image();
let backgroundLoaded = false;

backgroundImg.src = "img/background.png";
backgroundImg.onload = () => { backgroundLoaded = true; };
backgroundImg.onerror = () => { backgroundLoaded = false; };

/* ---------------------------
    RENDER TARJETAS
----------------------------- */
function renderInitiatives() {
  const theme = THEMES["desarrollo"];
  initiativesGrid.innerHTML = "";

  theme.initiatives.forEach(init => {
    const wrapper = document.createElement("div");

    const input = document.createElement("input");
    input.type = "checkbox";
    input.id = `init-${init.id}`;
    input.className = "initiative-input";
    input.dataset.img = init.img;
    input.dataset.label = init.label;

    const label = document.createElement("label");
    label.className = "initiative-card";
    label.setAttribute("for", input.id);

    const img = document.createElement("img");
    img.src = init.img;

    const caption = document.createElement("span");
    caption.textContent = init.label;

    label.appendChild(img);
    label.appendChild(caption);

    wrapper.appendChild(input);
    wrapper.appendChild(label);

    initiativesGrid.appendChild(wrapper);
  });
}

/* ---------------------------
  CARGA IM√ÅGENES DE LOGOS
----------------------------- */
function loadLogos(selectedInfos, callback) {
  if (!selectedInfos.length) return callback([]);

  const results = [];
  let loaded = 0;

  selectedInfos.forEach((info, index) => {
    const img = new Image();
    img.src = info.img;

    img.onload = () => {
      results[index] = { img, label: info.label };
      loaded++;
      if (loaded === selectedInfos.length) callback(results);
    };

    img.onerror = () => {
      loaded++;
      if (loaded === selectedInfos.length) callback(results.filter(Boolean));
    };
  });
}

/* ---------------------------
   DIBUJA LA POSTAL
----------------------------- */
function drawCard(logoImages) {
  const w = canvas.width;
  const h = canvas.height;

  // Fondo: primero imagen, si est√° cargada; si no, degradado
  if (backgroundLoaded) {
    ctx.drawImage(backgroundImg, 0, 0, w, h);
    // Capa oscura para que se lea el texto
    ctx.fillStyle = "rgba(15, 23, 42, 0.55)";
    ctx.fillRect(0, 0, w, h);
  } else {
    const grad = ctx.createLinearGradient(0, 0, w, h);
    grad.addColorStop(0, "#0f172a");
    grad.addColorStop(1, "#1e293b");
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, w, h);
  }

  // Marco
  ctx.strokeStyle = "rgba(148, 163, 184, 0.4)";
  ctx.lineWidth = 12;
  ctx.strokeRect(40, 40, w - 80, h - 80);

  // T√≠tulo
  ctx.fillStyle = "#e5e7eb";
  ctx.font = "bold 72px system-ui";
  ctx.textAlign = "center";
  ctx.fillText("Creciendo con", w / 2, 160);
  ctx.fillText("cada experiencia", w / 2, 240);

  // Nombre
  const name = document.getElementById("name").value.trim() || "Colaborador Tec";
  ctx.font = "500 40px system-ui";
  ctx.fillStyle = "#a5b4fc";
  ctx.fillText(name, w / 2, 310);

  // Tema
  ctx.font = "28px system-ui";
  ctx.fillStyle = "#cbd5f5";
  ctx.fillText("Tema: Desarrollo y Crecimiento", w / 2, 360);

  /* ---------------------------
        LOGOS EN FORMATO GRID
  ----------------------------- */
  const logos = logoImages || [];
  const maxLogos = Math.min(logos.length, 4);
  const logoSize = 220;

  if (maxLogos === 0) {
    ctx.textAlign = "left";
    ctx.font = "30px system-ui";
    ctx.fillStyle = "#e5e7eb";
    ctx.fillText("‚Ä¢ A√∫n estoy por elegir mis pr√≥ximas experiencias ‚ú®", 140, 450);
  } else {
    let positions;

    if (maxLogos === 1) {
      positions = [{ x: (w - logoSize) / 2, y: 430 }];
    } else if (maxLogos === 2) {
      positions = [
        { x: w / 2 - logoSize - 30, y: 430 },
        { x: w / 2 + 30, y: 430 }
      ];
    } else if (maxLogos === 3) {
      positions = [
        { x: w / 2 - logoSize - 30, y: 430 },
        { x: w / 2 + 30, y: 430 },
        { x: (w - logoSize) / 2, y: 430 + logoSize + 30 }
      ];
    } else {
      positions = [
        { x: w / 2 - logoSize - 30, y: 430 },
        { x: w / 2 + 30, y: 430 },
        { x: w / 2 - logoSize - 30, y: 430 + logoSize + 30 },
        { x: w / 2 + 30, y: 430 + logoSize + 30 }
      ];
    }

    logos.slice(0, 4).forEach((info, i) => {
      const img = info.img;
      const pos = positions[i];

      const maxW = logoSize;
      const maxH = logoSize;

      const realW = img.width;
      const realH = img.height;
      const ratio = realW / realH;

      let drawW, drawH;

      if (ratio > 1) {
        drawW = maxW;
        drawH = maxW / ratio;
      } else {
        drawH = maxH;
        drawW = maxH * ratio;
      }

      const finalX = pos.x + (maxW - drawW) / 2;
      const finalY = pos.y + (maxH - drawH) / 2;

      ctx.drawImage(img, finalX, finalY, drawW, drawH);
    });
  }

  // Footer
  ctx.textAlign = "center";
  ctx.font = "24px system-ui";
  ctx.fillStyle = "#9ca3af";
  ctx.fillText("Programas en los que particip√© este a√±o", w / 2, h - 120);
  ctx.fillStyle = "#6ee7b7";
  ctx.fillText("#AccionMiECO", w / 2, h - 70);
}

/* ---------------------------
      AL GENERAR POSTAL
----------------------------- */
document.getElementById("generateBtn").addEventListener("click", () => {

  const selectedInputs = [...document.querySelectorAll(".initiative-input")]
    .filter(i => i.checked)
    .map(i => ({ img: i.dataset.img, label: i.dataset.label }));

  loadLogos(selectedInputs, (logoImages) => {
    drawCard(logoImages);

    const dataURL = canvas.toDataURL("image/png");
    previewImage.src = dataURL;
    downloadLink.href = dataURL;
    output.style.display = "block";
  });

});

/* Inicializa */
renderInitiatives();
</script>

</body>
</html>
